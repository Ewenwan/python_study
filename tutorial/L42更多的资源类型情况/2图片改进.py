# coding:utf-8
# 情况2：纯静态网页获取图片
# 解决方案：requests包会接受响应的二进制数据，取出后写入到本地。
# 分析网页，比纯静态纯文本麻烦一点，图片往往通过src标签或a标签到网页，第一步先分析获取图片在网页上的url资源地址，第二部请求静态资源地址获取图片二进制信息。

import requests
from lxml import etree
import os
import time

#风景分类/分页列表
resp = requests.get('http://www.ivsky.com/tupian/ziranfengguang/index_2.html')
html_content = resp.content.decode()
print(html_content)


# 获取图解列表页每个图集连接
basedir = os.path.dirname(__file__)
# html_content = """
#   <body rel="art" data-id="49681"><div id="header"><div class="box"><div id="logo"><a href="http://www.ivsky.com">天堂图片网</a></div><ul id="menu"><li><a href="/">首页</a></li><li><a href="/tupian/" class="a_now">图片大全</a></li><li><a href="/bizhi/">桌面壁纸</a></li><li><a href="/Photo/" target="_blank">旧版</a></li></ul><div id="search"><div class="inp"><input type="text" id="ser_inp" class="ser_inp" value="找图，要善用搜索"></div><div class="inp-btn"><input type="submit" value="" id="ser_btn" class="ser_btn"></div></div><div id="login" style="display: block;">2018年12月24日<br> 周一 17:05:49</div></div><div class="hbg"></div></div><div class="box"><div id="alltop"><script>dy("alltop");</script></div><div id="tpimgtop1"><script>dy("tpimgtop1");</script><div style=""><iframe width="728" frameborder="0" height="90" scrolling="no" src="http://pos.baidu.com/s?hei=90&amp;wid=728&amp;di=u1729247&amp;ltu=http%3A%2F%2Fwww.ivsky.com%2Ftupian%2Fyueliang_v49681%2F%3Ftdsourcetag%3Ds_pcqq_aiomsg&amp;psi=3517a35963ad0d457ffc8be3083a3672&amp;dai=1&amp;par=1366x728&amp;cce=true&amp;pis=-1x-1&amp;cmi=4&amp;dc=3&amp;ti=%E5%A4%9C%E7%A9%BA%E4%B8%AD%E7%9A%84%E6%9C%88%E4%BA%AE%E5%9B%BE%E7%89%87%2013%E5%BC%A0%20(%E5%A4%A9%E5%A0%82%E5%9B%BE%E7%89%87%E7%BD%91)&amp;cfv=0&amp;cja=false&amp;psr=1366x768&amp;exps=111000,110012&amp;chi=1&amp;ari=2&amp;pcs=1349x657&amp;ccd=24&amp;drs=1&amp;pss=1349x664&amp;dis=0&amp;ant=0&amp;dri=0&amp;tpr=1545639748905&amp;tlm=1544580040&amp;dtm=HTML_POST&amp;cpl=3&amp;tcn=1545639749&amp;ps=92x174&amp;cec=UTF-8&amp;col=zh-CN&amp;cdo=-1"></iframe></div><script type="text/javascript" src="http://a.lanrentuku.com/kfogunubgimhnlou.js"></script>
# # # </div><div id="tpimgtop2"><script>dy("tpimgtop2");</script><div style="width: 100%;"><iframe width="267" frameborder="0" height="90" scrolling="no" src="http://pos.baidu.com/s?hei=90&amp;wid=267&amp;di=u1628852&amp;ltu=http%3A%2F%2Fwww.ivsky.com%2Ftupian%2Fyueliang_v49681%2F%3Ftdsourcetag%3Ds_pcqq_aiomsg&amp;psi=3517a35963ad0d457ffc8be3083a3672&amp;cpl=3&amp;tcn=1545639749&amp;cdo=-1&amp;col=zh-CN&amp;par=1366x728&amp;dai=2&amp;pss=1349x664&amp;ccd=24&amp;pcs=1349x657&amp;dri=0&amp;tpr=1545639748905&amp;ti=%E5%A4%9C%E7%A9%BA%E4%B8%AD%E7%9A%84%E6%9C%88%E4%BA%AE%E5%9B%BE%E7%89%87%2013%E5%BC%A0%20(%E5%A4%A9%E5%A0%82%E5%9B%BE%E7%89%87%E7%BD%91)&amp;chi=1&amp;cfv=0&amp;ps=92x907&amp;dis=0&amp;dtm=HTML_POST&amp;ant=0&amp;cmi=4&amp;dc=3&amp;cce=true&amp;cja=false&amp;tlm=1544580040&amp;cec=UTF-8&amp;psr=1366x768&amp;ari=2&amp;pis=-1x-1&amp;drs=1&amp;exps=111000,114011,110012"></iframe></div><script type="text/javascript" src="http://a.lanrentuku.com/kfoeuhhcuimhnlou.js"></script>
# # # </div></div><div class="box"><div class="pos"><a href="http://www.ivsky.com/">首页</a> &gt; <a href="/tupian/">图片大全</a> &gt; <a href="/tupian/ziranfengguang/">自然风光</a> &gt; <a href="/tupian/yueliang_v49681/">夜空中的月亮图片</a> 13张 </div><div class="sort"><ul class="tpmenu tong"><li class="s1"><a href="/tupian/" title="图片大全 - 唯美图片 - 好看的图片">所有图片</a></li><li class="s2on active"><a href="/tupian/ziranfengguang/" title="自然风光图片 - 自然风景图片">自然风光</a></li><li class="s3"><a href="/tupian/chengshilvyou/" title="城市旅游图片 - 世界各国城市图片">城市旅游</a></li><li class="s4"><a href="/tupian/dongwutupian/" title="动物图片 - 宠物图片 - 野生动物图片">动物图片</a></li><li class="s5"><a href="/tupian/zhiwuhuahui/" title="植物花卉图片 - 花图片 - 花草图片 - 植物图片">植物花卉</a></li><li class="s6"><a href="/tupian/haiyangshijie/" title="海洋世界 - 海洋风光图片 - 海底世界图片">海洋世界</a></li><li class="s7"><a href="/tupian/renwutupian/" title="人物图片 - 人物图片大全">人物图片</a></li><li class="s8"><a href="/tupian/meishishijie/" title="美食图片 - 国外美食甜点图片 - 中国传统美食小吃图片">美食世界</a></li><li class="s9"><a href="/tupian/wupin/" title="物品物件大全 - 生活用品 - 学习用品图片">物品物件</a></li><li class="s10"><a href="/tupian/yundongtiyu/" title="运动图片 - 体育、休闲、竞赛图片">运动体育</a></li><li class="s11"><a href="/tupian/jiaotongyunshu/" title="公路铁路运输 - 桥梁码头图片 - 车船飞机图片">交通运输</a></li><li class="s12"><a href="/tupian/jianzhuhuanjing/" title="世界著名建筑 - 各国建筑图片 - 建筑环境图片">建筑环境</a></li><li class="s13"><a href="/tupian/jiaju/" title="家居装饰设计图片 - 装修效果图 - 时尚家居图片">装饰装修</a></li><li class="s14"><a href="/tupian/guanggaosheji/" title="品牌广告设计 - 广告设计创意图片">广告设计</a></li><li class="s15"><a href="/tupian/katongtupian/" title="卡通插画图片 - 卡通人物形象、卡通风景图片">卡通图片</a></li><li class="s16"><a href="/tupian/jieritupian/" title="中国传统节日图片 - 国外知名节日图片">节日图片</a></li><li class="s17"><a href="/tupian/shejisucai/" title="设计素材图片 - 背景图片 - 花纹、底纹、边框素材图片">设计素材</a></li><li class="s18"><a href="/tupian/yishu/" title="艺术 - 绘画 - 民族艺术">艺术绘画</a></li><li class="s19"><a href="/tupian/qita/" title="其他类别图片">其他类别</a></li></ul></div><div class="album"><div class="al_tit"><h1>夜空中的月亮图片(13张) </h1><div class="al_h3">小鹏　<span id="arc_pubtime" rel="1544580020">1个星期前上传</span> / <span id="arc_click" rel="49681"> 您是第 1020 位浏览者 / </span> 本图集共有 13 张图片</div></div><div id="artinfo"><script>dy("artinfo");</script></div><div id="tpimgleft1"><script>dy("tpimgleft1");</script><div id="_7nfr6y4ygpl" style=""><iframe width="336" frameborder="0" height="280" scrolling="no" src="http://pos.baidu.com/s?hei=280&amp;wid=336&amp;di=u1266263&amp;ltu=http%3A%2F%2Fwww.ivsky.com%2Ftupian%2Fyueliang_v49681%2F%3Ftdsourcetag%3Ds_pcqq_aiomsg&amp;psi=3517a35963ad0d457ffc8be3083a3672&amp;col=zh-CN&amp;exps=111000,110012&amp;dtm=HTML_POST&amp;cdo=-1&amp;ari=2&amp;ti=%E5%A4%9C%E7%A9%BA%E4%B8%AD%E7%9A%84%E6%9C%88%E4%BA%AE%E5%9B%BE%E7%89%87%2013%E5%BC%A0%20(%E5%A4%A9%E5%A0%82%E5%9B%BE%E7%89%87%E7%BD%91)&amp;ps=397x174&amp;cfv=0&amp;drs=1&amp;ccd=24&amp;ant=0&amp;tlm=1544580040&amp;cpl=3&amp;cec=UTF-8&amp;pss=1349x697&amp;dri=0&amp;dai=3&amp;dc=3&amp;psr=1366x768&amp;dis=0&amp;par=1366x728&amp;chi=1&amp;pcs=1349x657&amp;cmi=4&amp;tcn=1545639749&amp;cja=false&amp;cce=true&amp;pis=-1x-1&amp;tpr=1545639748905"></iframe></div><script type="text/javascript" src="http://a.lanrentuku.com/ezioyyoyrcgorvwy.js"></script>
# # # </div><div class="al_info"><div class="al_h4">介绍</div><div class="al_p"><p>&nbsp;&nbsp;月亮总是那么的温暖，就像一只爱的手，每个寂静的夜晚都轻抚着大地妈妈，洒落在每个人的身上，洒落在每一寸肌肤，让人觉得暖融融的。</p></div></div></div><div class="left"><div id="tpimgleft2"><script>dy("tpimgleft2");</script></div><ul class="pli">           <li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782239.html" title="夜空中的月亮图片 3637x2424" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782239.html" title="夜空中的月亮图片 3637x2424" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782240.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-001.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782240.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782241.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-002.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782241.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782242.html" title="夜空中的月亮图片 4608x2592" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-003.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782242.html" title="夜空中的月亮图片 4608x2592" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782243.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-004.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782243.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782244.html" title="夜空中的月亮图片 4272x2848" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-005.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782244.html" title="夜空中的月亮图片 4272x2848" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782245.html" title="夜空中的月亮图片 2560x1920" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-006.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782245.html" title="夜空中的月亮图片 2560x1920" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782246.html" title="夜空中的月亮图片 4000x3000" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-007.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782246.html" title="夜空中的月亮图片 4000x3000" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782247.html" title="夜空中的月亮图片 5184x3888" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-008.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782247.html" title="夜空中的月亮图片 5184x3888" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782248.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-009.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782248.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782249.html" title="夜空中的月亮图片 3264x2176" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-010.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782249.html" title="夜空中的月亮图片 3264x2176" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782250.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-011.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782250.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li><li><div class="il_img" style="opacity: 1;"><a href="/tupian/yueliang_v49681/pic_782251.html" title="夜空中的月亮图片 4608x3456" target="_blank"><img src="http://img.ivsky.com/img/tupian/t/201806/15/yueliang-012.jpg" alt="夜空中的月亮图片"></a></div><p><a href="/tupian/yueliang_v49681/pic_782251.html" title="夜空中的月亮图片 4608x3456" target="_blank">夜空中的月亮图片 </a></p></li>    </ul><div id="tpimgleft3"><script>dy("tpimgleft3");</script></div><div id="tpimgleft4"><script>dy("tpimgleft4");</script></div><div class="page_c"></div><div id="tpimgleft5"><script>dy("tpimgleft5");</script><div style=""><iframe width="760" frameborder="0" height="90" scrolling="no" src="//pos.baidu.com/s?hei=90&amp;wid=760&amp;di=u1265346&amp;ltu=http%3A%2F%2Fwww.ivsky.com%2Ftupian%2Fyueliang_v49681%2F%3Ftdsourcetag%3Ds_pcqq_aiomsg&amp;psi=3517a35963ad0d457ffc8be3083a3672&amp;dtm=HTML_POST&amp;pis=-1x-1&amp;cec=UTF-8&amp;ant=0&amp;psr=1366x768&amp;par=1366x728&amp;cpl=3&amp;chi=1&amp;dai=4&amp;ari=2&amp;cja=false&amp;dis=0&amp;cmi=4&amp;tlm=1544580040&amp;drs=1&amp;cdo=-1&amp;exps=111000,110012&amp;pcs=1349x657&amp;pss=1349x1845&amp;cce=true&amp;dri=0&amp;tcn=1545639749&amp;col=zh-CN&amp;dc=3&amp;cfv=0&amp;tpr=1545639748905&amp;ti=%E5%A4%9C%E7%A9%BA%E4%B8%AD%E7%9A%84%E6%9C%88%E4%BA%AE%E5%9B%BE%E7%89%87%2013%E5%BC%A0%20(%E5%A4%A9%E5%A0%82%E5%9B%BE%E7%89%87%E7%BD%91)&amp;ps=1459x174&amp;ccd=24"></iframe></div><script type="text/javascript" src="http://a.lanrentuku.com/fajpzxswzdh.js"></script>
# # # </div><div id="tpimgleft6"><script>dy("tpimgleft6");</script></div><div class="lxg"><div class="lxg_tit">相关的图集...</div><ul class="lxg_ul"><li><div class="xg_img"><a href="/tupian/weimei_de_yueqiu_v28784/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201507/24/weimei_de_yueqiu-004.jpg" alt="唯美的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/weimei_de_yueqiu_v28784/" title="唯美的月亮图片(11张)" target="_blank">唯美的月亮图片(11张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/weimei_yueqiu_v28875/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201507/27/weimei_yueqiu.jpg" alt="航拍月球图片"></a></div><div class="lxg_info"><p><a href="/tupian/weimei_yueqiu_v28875/" title="航拍月球图片(12张)" target="_blank">航拍月球图片(12张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/yueliang_v49517/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201806/05/yueliang-013.jpg" alt="夜空中唯美的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v49517/" title="夜空中唯美的月亮图片(14张)" target="_blank">夜空中唯美的月亮图片(14张)</a></p></div></li><li class="lxg_line"></li><li><div class="xg_img"><a href="/tupian/yueliang_v49681/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201806/15/yueliang.jpg" alt="夜空中的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v49681/" title="夜空中的月亮图片(13张)" target="_blank">夜空中的月亮图片(13张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/yueliang_v49362/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201805/29/yueliang-005.jpg" alt="皎洁的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v49362/" title="皎洁的月亮图片(14张)" target="_blank">皎洁的月亮图片(14张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/canque_yueliang_v49330/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201805/27/canque_yueliang-006.jpg" alt="残缺的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/canque_yueliang_v49330/" title="残缺的月亮图片(15张)" target="_blank">残缺的月亮图片(15张)</a></p></div></li><li class="lxg_line"></li><li><div class="xg_img"><a href="/tupian/yueliang_v46642/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201801/31/yueliang-006.jpg" alt="圆圆的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v46642/" title="圆圆的月亮图片(13张)" target="_blank">圆圆的月亮图片(13张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/yueliang_v43949/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201709/25/yueliang-006.jpg" alt="一轮弯弯的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v43949/" title="一轮弯弯的月亮图片(12张)" target="_blank">一轮弯弯的月亮图片(12张)</a></p></div></li><li><div class="xg_img"><a href="/tupian/yueliang_v46644/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201801/31/yueliang-022.jpg" alt="皎洁的月亮图片"></a></div><div class="lxg_info"><p><a href="/tupian/yueliang_v46644/" title="皎洁的月亮图片(12张)" target="_blank">皎洁的月亮图片(12张)</a></p></div></li><li class="lxg_line"></li></ul></div><div id="tpimgleft7"><script>dy("tpimgleft7");</script></div><div id="tpimgleft8"><script>dy("tpimgleft8");</script></div></div><div class="right"><div id="tpimgr1"><script>dy("tpimgr1");</script><div id="_qmchnn5i778" style=""><iframe width="160" frameborder="0" height="600" scrolling="no" src="http://pos.baidu.com/s?hei=600&amp;wid=160&amp;di=u3467566&amp;ltu=http%3A%2F%2Fwww.ivsky.com%2Ftupian%2Fyueliang_v49681%2F%3Ftdsourcetag%3Ds_pcqq_aiomsg&amp;psi=3517a35963ad0d457ffc8be3083a3672&amp;col=zh-CN&amp;par=1366x728&amp;psr=1366x768&amp;ccd=24&amp;cdo=-1&amp;cce=true&amp;cja=false&amp;cfv=0&amp;tlm=1544580040&amp;cec=UTF-8&amp;drs=1&amp;dai=5&amp;dc=3&amp;ps=717x1014&amp;pcs=1349x657&amp;ant=0&amp;dtm=HTML_POST&amp;pss=1349x2114&amp;tcn=1545639749&amp;ti=%E5%A4%9C%E7%A9%BA%E4%B8%AD%E7%9A%84%E6%9C%88%E4%BA%AE%E5%9B%BE%E7%89%87%2013%E5%BC%A0%20(%E5%A4%A9%E5%A0%82%E5%9B%BE%E7%89%87%E7%BD%91)&amp;tpr=1545639748905&amp;chi=1&amp;pis=-1x-1&amp;dis=0&amp;dri=0&amp;cpl=3&amp;exps=111000,110012&amp;ari=2&amp;cmi=4"></iframe></div><script type="text/javascript" src="http://a.lanrentuku.com/pkcgjlhjj.js"></script>
# # # </div>        <div class="rb"><div class="rtit">所属小分类</div><ul class="timg_ul"><li><div class="t_img"><a href="/tupian/weimei_t5095/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201101/20/haibian_weimei_riluo-002.jpg" width="125" height="77" alt="唯美图片_唯美图片大全"></a></div><div class="t_info"><p><a href="/tupian/weimei_t5095/" title="唯美图片_唯美图片大全" target="_blank">唯美图片(2678张)</a></p></div></li><li><div class="t_img"><a href="/tupian/yekong_t19444/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201308/30/yueyuanzhiye-006.jpg" width="125" height="77" alt="夜空图片"></a></div><div class="t_info"><p><a href="/tupian/yekong_t19444/" title="夜空图片" target="_blank">夜空图片(689张)</a></p></div></li><li><div class="t_img"><a href="/tupian/yueliang_t20603/" target="_blank"><img src="http://img.ivsky.com/img/tupian/m/201308/30/yueyuanzhiye-007.jpg" width="125" height="77" alt="月亮图片"></a></div><div class="t_info"><p><a href="/tupian/yueliang_t20603/" title="月亮图片" target="_blank">月亮图片(387张)</a></p></div></li></ul></div><div id="tpimgr2"><script>dy("tpimgr2");</script></div></div></div><div class="box"><div class="f_rec"><b>推荐内容：</b><a href="/tupian/shilulu_t42843/" title="湿漉漉图片">湿漉漉图片</a><a href="/tupian/maitian_t268/" title="麦田图片">麦田图片</a><a href="/tupian/xueshe_t29850/" title="雪舌图片">雪舌图片</a><a href="/tupian/xinggui_t27924/" title="星轨图片">星轨图片</a><a href="/tupian/xueshan_dingbujing_t35820/" title="雪山顶部景图片">雪山顶部景图片</a><a href="/tupian/lvyi_angran_t44016/" title="绿意盎然图片">绿意盎然图片</a><a href="/tupian/huashu_t28962/" title="桦树图片">桦树图片</a><a href="/tupian/hongse_yanshi_t44769/" title="红色岩石图片">红色岩石图片</a><a href="/tupian/caodi_t2229/" title="草地图片">草地图片</a><a href="/tupian/mingyue_t20604/" title="明月图片">明月图片</a><a href="/tupian/haichao_t36540/" title="海潮图片">海潮图片</a><a href="/tupian/eke_tuosai_hegu_t29810/" title="鄂克托赛河谷图片">鄂克托赛河谷图片</a><a href="/tupian/ziran_zaihai_t38633/" title="自然灾害图片">自然灾害图片</a><a href="/tupian/dacong_t9259/" title="大葱图片">大葱图片</a><a href="/tupian/lantian_t1484/" title="蓝天图片">蓝天图片</a><a href="/tupian/wuyun_t2967/" title="乌云图片">乌云图片</a><a href="/tupian/tianqi_xianxiang_t41109/" title="天气现象图片">天气现象图片</a><a href="/tupian/tudi_t4728/" title="土地图片">土地图片</a><a href="/tupian/sha_t35456/" title="沙图片">沙图片</a><a href="/tupian/bilv_de_dahai_t39376/" title="碧绿的大海图片">碧绿的大海图片</a><div><b>手机版：</b><a href="http://m.ivsky.com/tupian/yueliang_v49681/" target="_blank">夜空中的月亮图片(13张)</a> </div></div></div><div class="box"><div id="tpimgbtm"><script>dy("tpimgbtm");</script></div><div id="tpimgbtm2"><script>dy("tpimgbtm2");</script></div><div id="tppagebtm"><script>dy("tppagebtm");</script></div><div id="tppagebtm2"><script>dy("tppagebtm2");</script></div></div><div id="footer"><div class="box"><div id="fl"><dl><dt>关于</dt><dd><a href="/about/about.html" rel="nofollow">关于天堂</a></dd><dd><a href="/about/disclaimer.html" rel="nofollow">免责声明</a></dd>			</dl><dl><dt>帮助</dt><dd><a href="/about/tougao.html" rel="nofollow">用户投稿</a></dd><dd><a href="/about/faq.html" rel="nofollow">常见问题</a></dd></dl><dl><dt>联系</dt><dd><a href="/about/contact.html" rel="nofollow">联系我们</a></dd><dd><a href="/about/guestbook.html" rel="nofollow">留言反馈</a></dd><dd><a href="/about/ad.html" rel="nofollow">广告投放</a></dd></dl><dl><dt>关注</dt><dd class="sina"><a href="http://weibo.com/ivskycom" target="_blank" rel="nofollow">新浪微博</a></dd><dd>公众号<br><img src="http://img.ivsky.com/img/images/qrcode_gzh.jpg" width="75" height="75"></dd></dl></div><div id="fr"><p>© 2005-2018 天堂图片网　闽ICP备05021777号-1　闽公网安备 35020302011402号</p><p>本站图片收集自网络，仅供个人学习交流使用，版权归原作者所有，请勿用于任何商业用途</p><p>主机服务商：<a href="http://www.aliyun.com/cps/rebate?from_uid=jJfSOSVZ99F3GCoDuIogFvjezZSHMCm8" target="_blank">阿里云</a> &nbsp; <a href="http://www.chinaccnet.com/" target="_blank">中电云集</a></p></div></div></div><script>dy("tbox");</script><div id="tbox"><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">
#  	</a><a id="gotop" href="javascript:void(0)" target="_top" rel="nofollow" style="display: block;"></a>
#  	<a id="jy" href="/about/guestbook.html" rel="nofollow" style="display: block;"></a>
#  </div>
#  <div id="tj"><script>dy("tj");</script></div><script src="/sky.php?do=viewarticle&amp;id=49681&amp;show=1&amp;callback=viewcallback1545639749165&amp;_t=1545639749165"></script></body>
# """

# 获取图片src地址列表
html_tree = etree.HTML(html_content)
pattern = '//ul[@class="ali"]/li/div/a/@href'
pattern2 = '//ul[@class="ali"]/li/p/a/text()'
# 图集连接列表，突击名
img_set_url_list = html_tree.xpath(pattern)
img_set_name_list = html_tree.xpath(pattern2)

print(img_set_url_list)
print(img_set_name_list)   # 输出需要的爬取图片的地址

# 循环获取每个图集下所有缩略图
for i in range(0,len(img_set_url_list)):
    print('开始本页第{}个图集'.format(i+1))
    # 当前脚本所在目录生成图集名文件夹
    if not os.path.exists(os.path.join(basedir,img_set_name_list[i])):
        # 根据图集名创建子文件夹
        os.mkdir(os.path.join(basedir,img_set_name_list[i]))
        print('创建图集目录',os.path.join(basedir,img_set_name_list[i]))
        # 请求图集详情页   。   下面的代码跟上结课一样
        resp = requests.get(('http://www.ivsky.com'+img_set_url_list[i]))
        sub_html_content = resp.text
        sub_html_etree = etree.HTML(sub_html_content)
        # 获取图片资源src连接
        img_src_list = sub_html_etree.xpath("//ul[@class='pli']/li/div/a/img/@src")
        img_name_list = sub_html_etree.xpath("//ul[@class='pli']/li/div/a/img/@alt")
        print(img_src_list)
        for j,img_src in enumerate(img_src_list):
            # 请求图片二进制
            print('开始下载本图集第{}张图片'.format(j))
            resp = requests.get(img_src,timeout=10)
            if not resp.status_code == 200:
                print('请求失败')
            img_bytes = resp.content
            print(img_bytes)
            # 拼图篇绝对路径，保存
            print(os.path.join(img_set_name_list[i],f'{j}.jpg'))
            with open(os.path.join(img_set_name_list[i],f'{j}.jpg'),mode='wb') as f :
                f.write(img_bytes)
            break  # 注释此行以爬取所有图集

