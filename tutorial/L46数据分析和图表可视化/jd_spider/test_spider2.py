import requests
import time, datetime
import logging
import json
import random
from config import COMMENT_REQUEST, COMMON_REQUEST
from model import *

"""
"""
# 首页一个list请求无返回数据，没有解决。只找到含有id列表的一个js请求接口。
# 目录737 794 798 电视
PRODUCT_TV = [
    {"op":"3788.00","m":"10000.00","id":"J_6946605","p":"3788.00"},{"op":"749.00","m":"1299.00","id":"J_3888216","p":"749.00"},{"op":"5599.00","m":"9999.00","id":"J_3133859","p":"5599.00"},{"op":"3399.00","m":"5788.00","id":"J_3726830","p":"3399.00"},{"op":"4599.00","m":"6188.00","id":"J_3133827","p":"4599.00"},{"op":"2388.00","m":"3788.00","id":"J_4483110","p":"2388.00"},{"op":"5799.00","m":"9999.00","id":"J_5089275","p":"5499.00"},{"op":"8316.00","m":"9999.00","id":"J_5089253","p":"8316.00"},{"op":"2299.00","m":"3000.00","id":"J_5181380","p":"2299.00"},{"op":"1199.00","m":"1499.00","id":"J_6631219","p":"1199.00"},{"op":"1399.00","m":"9999.00","id":"J_6600258","p":"1399.00"},{"op":"1999.00","m":"2200.00","id":"J_6840911","p":"1999.00"},{"op":"2599.00","m":"9999.00","id":"J_7348367","p":"2599.00"},{"op":"3299.00","m":"5001.00","id":"J_5001209","p":"2799.00"},{"op":"2988.00","m":"4388.00","id":"J_4483072","p":"2988.00"},{"op":"699.90","m":"999.01","id":"J_4510588","p":"689.00"},{"op":"1999.00","m":"3899.00","id":"J_4586850","p":"1999.00"},{"op":"1399.00","m":"2199.00","id":"J_3355143","p":"1399.00"},{"op":"4899.00","m":"9999.00","id":"J_5089225","p":"4899.00"},{"op":"5488.00","m":"10000.00","id":"J_6946603","p":"5488.00"},{"op":"599.00","m":"10000.00","id":"J_4914531","p":"599.00"},{"op":"1099.00","m":"9999.00","id":"J_6008133","p":"1099.00"},{"op":"1399.00","m":"2399.00","id":"J_3234250","p":"1399.00"},{"op":"849.00","m":"1099.00","id":"J_2600242","p":"849.00"},{"op":"899.00","m":"9999.00","id":"J_6703015","p":"899.00"},{"op":"1999.00","m":"3299.01","id":"J_3322621","p":"1799.00"},{"op":"1299.00","m":"99999.00","id":"J_5663902","p":"1199.00"},{"op":"999.00","m":"10000.00","id":"J_4154609","p":"999.00"},{"op":"1499.00","m":"1999.00","id":"J_3893501","p":"1499.00"},{"op":"1499.00","m":"10000.00","id":"J_6737464","p":"1499.00"},
    {"op":"1699.00","m":"5000.00","id":"J_5159242","p":"1499.00"},{"op":"1299.00","m":"1699.00","id":"J_4884236","p":"1299.00"},{"op":"149.00","m":"200.00","id":"J_4720749","p":"149.00"},{"op":"2999.00","m":"4699.00","id":"J_3749089","p":"2999.00"},{"op":"699.00","m":"5000.00","id":"J_6703337","p":"699.00"},{"op":"9999.00","m":"99999.00","id":"J_7224901","p":"9999.00"},{"op":"2799.00","m":"9999.00","id":"J_5853579","p":"2799.00"},{"op":"1299.00","m":"1799.00","id":"J_2962435","p":"1299.00"},{"op":"899.00","m":"9999.00","id":"J_4768465","p":"899.00"},{"op":"1799.00","m":"10000.00","id":"J_4154589","p":"1799.00"},{"op":"599.00","m":"799.00","id":"J_3901917","p":"599.00"},{"op":"999.00","m":"3100.00","id":"J_5835263","p":"999.00"},{"op":"599.00","m":"699.00","id":"J_10932167751","p":"555.00"},{"op":"1099.00","m":"2499.00","id":"J_3602644","p":"999.00"},{"op":"2499.00","m":"9999.00","id":"J_7012230","p":"2499.00"},{"op":"2599.00","m":"4599.00","id":"J_11960714890","p":"2275.00"},{"op":"2299.00","m":"3001.00","id":"J_5001175","p":"2099.00"},{"op":"1699.00","m":"10000.00","id":"J_7119306","p":"1699.00"},{"op":"3198.00","m":"9999.00","id":"J_6708229","p":"3198.00"},{"op":"1199.00","m":"1599.00","id":"J_3604173","p":"1199.00"},{"op":"1699.00","m":"8888.00","id":"J_6999009","p":"1699.00"},{"op":"6999.00","m":"7800.00","id":"J_6577495","p":"6999.00"},{"op":"1399.00","m":"1600.00","id":"J_4143422","p":"1099.00"},{"op":"4199.00","m":"10000.00","id":"J_5544038","p":"4199.00"},{"op":"169.00","m":"199.00","id":"J_3315699","p":"169.00"},{"op":"1299.00","m":"3000.00","id":"J_2868393","p":"1299.00"},{"op":"1499.00","m":"1700.00","id":"J_4554941","p":"1499.00"},{"op":"6099.00","m":"6500.00","id":"J_6577477","p":"6099.00"},{"op":"1999.00","m":"9999.00","id":"J_4734101","p":"1999.00"},{"op":"6699.00","m":"7300.00","id":"J_6405876","p":"6699.00"},
    {"op":"5599.00","m":"5999.00","id":"J_4341091","p":"3599.00","up":"tpp","tpp":"3399.00"},{"op":"1398.00","m":"1698.00","id":"J_647948","p":"799.00"},{"op":"26999.00","m":"27999.00","id":"J_6642422","p":"25999.00"},{"op":"6199.00","m":"6200.00","id":"J_5308972","p":"4599.00"},{"op":"4999.00","m":"5199.00","id":"J_1427585","p":"2599.00"},{"op":"3799.00","m":"4199.00","id":"J_6349457","p":"2799.00"},{"op":"1199.00","m":"1399.00","id":"J_15703012493","p":"999.00"},{"op":"8999.00","m":"9599.00","id":"J_5170816","p":"6199.00","up":"tpp","tpp":"5979.00"},{"op":"1699.00","m":"1899.00","id":"J_1242386","p":"998.00"},{"op":"10799.00","m":"10899.00","id":"J_4512327","p":"8799.00"},{"op":"6699.00","m":"6799.00","id":"J_4512349","p":"4798.00"},{"op":"2199.00","m":"2399.00","id":"J_4991322","p":"1599.00"},{"op":"3099.00","m":"3199.00","id":"J_5831361","p":"2199.00"},{"op":"2999.00","m":"3599.00","id":"J_10387353668","p":"2199.00"},{"op":"5499.00","m":"6899.00","id":"J_5566104","p":"3388.00"},{"op":"7499.00","m":"7999.00","id":"J_4902977","p":"5298.00"},{"op":"1099.00","m":"1199.00","id":"J_6930429","p":"999.00"},{"op":"2499.00","m":"2699.00","id":"J_6386829","p":"1699.00"},{"op":"3999.00","m":"4099.00","id":"J_3788407","p":"1999.00"},{"op":"6199.00","m":"6599.00","id":"J_3473283","p":"3999.00"},{"op":"4599.00","m":"5599.00","id":"J_5188792","p":"3199.00"},{"op":"1999.00","m":"2299.00","id":"J_23331533553","p":"1399.00"},{"op":"9499.00","m":"9500.00","id":"J_4447537","p":"6599.00"},{"op":"1398.00","m":"1598.00","id":"J_941189","p":"898.00"},{"op":"29999.00","m":"32999.00","id":"J_6325084","p":"26999.00"},{"op":"2199.00","m":"2199.00","id":"J_5373198","p":"1699.00"},{"op":"4999.00","m":"5999.00","id":"J_5198359","p":"3499.00"},{"op":"6399.00","m":"6499.00","id":"J_5284468","p":"5499.00"},{"op":"6999.00","m":"7599.00","id":"J_5523203","p":"5099.00"},{"op":"23999.00","m":"26999.00","id":"J_4853850","p":"18999.00"},
    {"op":"2999.00","m":"5999.00","id":"J_10069672023","p":"2799.00"},{"op":"4799.00","m":"4999.00","id":"J_3900914","p":"3699.00"},{"op":"2099.00","m":"2099.00","id":"J_2368534","p":"1299.00"},{"op":"4099.00","m":"4599.00","id":"J_27352898906","p":"3599.00"},{"op":"3399.00","m":"3599.00","id":"J_3367424","p":"2299.00"},{"op":"3999.00","m":"3999.00","id":"J_4512329","p":"2799.00"},{"op":"4699.00","m":"4999.00","id":"J_4015468","p":"3399.00","up":"tpp","tpp":"3319.00"},{"op":"2999.00","m":"2999.00","id":"J_2669873","p":"1799.00"},{"op":"6599.00","m":"6999.00","id":"J_5315409","p":"5299.00","up":"tpp","tpp":"4903.00"},{"op":"30999.00","m":"31999.00","id":"J_3985509","p":"19999.00"},{"op":"1999.00","m":"1999.00","id":"J_2929999","p":"1299.00"},{"op":"1699.00","m":"1899.00","id":"J_7171106","p":"1599.00"},{"op":"4199.00","m":"4999.00","id":"J_6363238","p":"3598.00"},{"op":"11999.00","m":"12999.00","id":"J_5278181","p":"8498.00"},{"op":"4299.00","m":"5599.00","id":"J_2808881","p":"2999.00","up":"tpp","tpp":"2939.00"},{"op":"17999.00","m":"19999.00","id":"J_6455001","p":"15999.00"},{"op":"4399.00","m":"5399.00","id":"J_4014403","p":"2999.00"},{"op":"2999.00","m":"3199.00","id":"J_7171104","p":"2999.00"},{"op":"1299.00","m":"1499.00","id":"J_1257425","p":"799.00"},{"op":"2599.00","m":"2899.00","id":"J_5092765","p":"1799.00","up":"tpp","tpp":"1749.00"},{"op":"2699.00","m":"2799.00","id":"J_4126187","p":"1699.00"},{"op":"16999.00","m":"17999.00","id":"J_6642424","p":"15999.00"},{"op":"5999.00","m":"7999.00","id":"J_10340542681","p":"4299.00"},{"op":"2199.00","m":"2599.00","id":"J_7269559","p":"1799.00"},{"op":"4999.00","m":"5499.00","id":"J_6933429","p":"4398.00","up":"tpp","tpp":"4187.00"},{"op":"11499.00","m":"11500.00","id":"J_3227578","p":"7399.00"},{"op":"2499.00","m":"2999.00","id":"J_5461541","p":"1999.00"},{"op":"6999.00","m":"7999.00","id":"J_4725704","p":"4999.00"},{"op":"3499.00","m":"3499.00","id":"J_23350052040","p":"2799.00"},{"op":"3399.00","m":"3499.00","id":"J_6888968","p":"2999.00"},
]

def product_id_write():
    """ 写product表"""
    for tv in PRODUCT_TV:
        product = dict(
            category1 = 737,
            category2 = 794,
            category3 = 798,
            product_id = tv['id'].replace('J_', ''),
            price = tv['p'],
            crawl_comment_num = 0,
            emotion_score = 0
        )
        # product, created = Product.get_or_create(
        #     category1 = 737,
        #     category2 = 794,
        #     category3 = 798,
        #     product_id = tv['id'],
        #     price = tv['p'],
        #     crawl_comment_num = 0)
        product, created = Product.get_or_create(
            **product)
        print(product.id, created == True)


def crawl_comment_by_c3(c1=None, c2=None, c3=None):
    """ 批量爬评论
    :param c1:
    :param c2:
    :param c3:
    :return:
    """
    products = Product.select().where(Product.crawl_comment_num ==0)    # 没有爬过评论的
    for i, product in enumerate(products):
        product_id = product.product_id
        if CrawlLog.select().where(CrawlLog.product_id==product_id, CrawlLog.success==True).count() > 10:
            print('抓取历史log大于100条跳过')
            continue

        url = 'http://127.0.0.1:5000/crawl_comment/{}/0'.format(product_id)
        resp = requests.get(url)
        print(resp.text)

        # 测试 todo
        if i == 2:
            break

if __name__ == '__main__':
    # product_id_write()
    pass

